import{s as p}from"./supabaseClient.BBNiQqDa.js";const y=document.getElementById("matchForm"),f=document.getElementById("match_type"),d=document.getElementById("opponent_club_container"),u=document.getElementById("opponent_name_container");f?.addEventListener("change",n=>{const a=n.target.value,o=document.querySelector('[name="opponent_club_id"]'),e=document.querySelector('[name="opponent_name"]');a==="MCDO_POOL"?(d?.classList.remove("hidden"),u?.classList.add("hidden"),o.required=!0,e.required=!1,e.value=""):(d?.classList.add("hidden"),u?.classList.remove("hidden"),o.required=!1,e.required=!0,o.value="")});y?.addEventListener("submit",async n=>{n.preventDefault();const a=n.target,o=a.dataset.matchId,e=new FormData(a),r=e.get("match_image");let l=null;if(r)try{const t=`${Date.now()}_${r.name}`,{data:c,error:m}=await p.storage.from("Images").upload(t,r);if(m)throw m;const{data:h}=p.storage.from("Images").getPublicUrl(c.path);l=h.publicUrl}catch(t){console.error("Error uploading image:",t),alert("Erreur lors du téléchargement de l'image.");return}const g=e.getAll("players").map(t=>parseInt(t.toString())),s=e.get("match_type"),i=e.get("opponent_club_id"),_={date:e.get("date"),time:e.get("time"),match_type:s,competition_round:e.get("competition_round")||null,location:e.get("location"),opponent_name:s==="MCDO_POOL"?document.querySelector(`[name="opponent_club_id"] option[value="${i}"]`)?.textContent:e.get("opponent_name"),opponent_club_id:s==="MCDO_POOL"?parseInt(i):null,lineup_image:l,opponent_logo:e.get("opponent_logo")||null,home_score:e.get("home_score")?parseInt(e.get("home_score").toString()):null,away_score:e.get("away_score")?parseInt(e.get("away_score").toString()):null,is_completed:e.get("is_completed")==="on",players:g.map(t=>({player_id:t,goals:parseInt(e.get(`goals_${t}`)?.toString()||"0"),assists:parseInt(e.get(`assists_${t}`)?.toString()||"0")}))};try{const t=await fetch(`/api/matches/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(!t.ok){const c=await t.json();throw new Error(c.message||"Error updating match")}window.location.href="/admin/matches"}catch(t){console.error("Error:",t),alert(t instanceof Error?t.message:"Error updating match")}});
